trigger:
- master
- profiler

pool:
  # This is the name of the agent pool to run the tests on
  name: Jetson

stages:
  - stage: Test
    jobs:
    
    - job:
      displayName: Runs my CUDA program
      steps:
      - script: make -j -k -C MySampleProgram
        displayName: 'Runs our program'
      - script: mkdir out && nvprof -o out/cudaProgram.nvvp --log-file out/cudaProgram.log ./MySampleProgram/cudaProgram
        displayName: 'Creates logs of program'
      - script: ./check.sh ./MySampleProgram/cudaProgram > out/result.txt
        displayName: 'Check which features are used'
      - publish: ./out
        artifact: 'Profiler Logs'
